<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mistry AI - The Mystical AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'cinzel': ['Cinzel', 'serif'],
                        'cinzel-deco': ['"Cinzel Decorative"', 'serif'],
                        'railway': ['Railway', 'sans-serif'],
                        'poppins': ['Poppins', 'sans-serif'],
                        'quicksand': ['Quicksand', 'sans-serif'],
                    },
                    colors: {
                        mystical: {
                            teal: '#0d9488',
                            green: '#22c55e',
                            gold: '#fbbf24',
                            dark: '#0f172a',
                            light: '#f8fafc'
                        }
                    },
                    keyframes: {
                        'sparkle': {
                            '0%, 100%': { transform: 'scale(1) rotate(0deg)', opacity: '1' },
                            '50%': { transform: 'scale(1.2) rotate(180deg)', opacity: '0.8' }
                        },
                        'float': {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    },
                    animation: {
                        'sparkle': 'sparkle 2s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite'
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Cinzel+Decorative:wght@400;700;900&family=Railway:wght@400;500;600&family=Poppins:wght@300;400;500;600&family=Quicksand:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        .delay-2000 { animation-delay: 2s; }
        .delay-500 { animation-delay: 0.5s; }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-25%); }
        }
        .animate-bounce { animation: bounce 1s infinite; }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: scale-in 0.2s ease-out;
        }
        @keyframes scale-in {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        .close-btn:hover {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gradient-to-br from-mystical-teal via-teal-600 to-mystical-green relative overflow-hidden">
        <!-- Sparkles with multiple stars -->
        <div class="absolute top-10 left-10 text-mystical-gold animate-sparkle">
            <div class="relative">
                <!-- Main star -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
                <!-- Small stars around main star -->
                <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="currentColor" class="absolute -top-2 -left-2 animate-sparkle delay-100">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="6" height="6" viewBox="0 0 24 24" fill="currentColor" class="absolute -bottom-1 -right-1 animate-sparkle delay-300">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
            </div>
        </div>
        <div class="absolute top-20 right-16 text-mystical-gold animate-sparkle">
            <div class="relative">
                <!-- Main star -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
                <!-- Small stars around main star -->
                <svg xmlns="http://www.w3.org/2000/svg" width="7" height="7" viewBox="0 0 24 24" fill="currentColor" class="absolute -top-1 -left-1 animate-sparkle delay-200">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="5" height="5" viewBox="0 0 24 24" fill="currentColor" class="absolute -bottom-1 -right-1 animate-sparkle delay-400">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
            </div>
        </div>
        <div class="absolute bottom-32 left-20 text-mystical-gold animate-sparkle delay-2000">
            <div class="relative">
                <!-- Main star -->
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
                <!-- Small stars around main star -->
                <svg xmlns="http://www.w3.org/2000/svg" width="9" height="9" viewBox="0 0 24 24" fill="currentColor" class="absolute -top-2 -left-2 animate-sparkle delay-500">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="7" height="7" viewBox="0 0 24 24" fill="currentColor" class="absolute -bottom-1 -right-1 animate-sparkle delay-600">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
            </div>
        </div>
        <div class="absolute bottom-20 right-10 text-mystical-gold animate-sparkle delay-500">
            <div class="relative">
                <!-- Main star -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
                <!-- Small stars around main star -->
                <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="currentColor" class="absolute -top-1 -left-1 animate-sparkle delay-700">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="6" height="6" viewBox="0 0 24 24" fill="currentColor" class="absolute -bottom-1 -right-1 animate-sparkle delay-800">
                    <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                </svg>
            </div>
        </div>

        <!-- Info Button -->
        <button id="infoBtn" class="fixed top-6 right-8 z-50 bg-white bg-opacity-90 hover:bg-mystical-gold/85 text-mystical-gold border border-mystical-gold transition-all shadow-xl rounded-full p-0 flex items-center justify-center w-11 h-11">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <path d="m9 12 2 2 4-4"/>
            </svg>
        </button>

        <!-- Info Modal -->
        <div id="infoModal" class="modal">
            <div class="modal-content">
                <button class="close-btn" id="closeModal">&times;</button>
                <div class="mb-4 font-cinzel-deco text-3xl text-mystical-gold flex justify-center items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-sparkle">
                        <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                    </svg>
                    Builder Info
                </div>
                <div class="text-lg font-quicksand text-mystical-dark">
                    <span class="font-semibold">Built by </span>
                    Arka Das <br />
                    <span class="italic text-mystical-gold">(Chief of Kenfex IT)</span>
                </div>
            </div>
        </div>

        <div class="container mx-auto px-4 py-8 max-w-4xl relative z-10">
            <!-- Header -->
            <header class="text-center mb-8 animate-float relative">
                <div class="flex justify-center items-center mb-4 flex-col">
                    <div class="rounded-full bg-white p-1 mb-2 shadow-lg">
                        <img 
                            src="https://lovable.dev/uploads/2d8c25c0-04a6-4070-9f86-cf375f3b7528.png"
                            alt="Mistry AI Logo"
                            class="w-24 h-24 rounded-full drop-shadow-lg"
                        />
                    </div>
                    <div>
                        <h1 class="font-cinzel-deco text-5xl font-bold text-white drop-shadow-lg mb-2 tracking-wide">
                            Mistry AI
                        </h1>
                        <p class="font-cinzel-deco text-xl text-mystical-light/90 mb-2">
                            Mistry AI
                        </p>
                        <p class="font-cinzel-deco text-xl text-mystical-light/90">
                            The Mystical AI Assistant
                        </p>
                    </div>
                </div>
                <p class="font-poppins text-mystical-light/80 italic">
                    "Wisdom from ancient scrolls, powered by modern enchantments"
                </p>
            </header>

            <!-- File Memory Panel -->
            <div id="fileMemoryPanel" class="bg-white/15 backdrop-blur-sm border border-mystical-gold/40 rounded-lg mb-4 p-4 hidden">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-mystical-light font-quicksand font-semibold flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                            <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/>
                            <path d="M14 2v4a2 2 0 0 0 2 2h4"/>
                        </svg>
                        AI Memory (<span id="fileCount">0</span> files)
                    </h3>
                    <button id="clearAllFiles" class="bg-white/20 text-mystical-light hover:bg-white/30 border border-mystical-gold/30 px-3 py-1 rounded-lg text-sm">
                        Clear All
                    </button>
                </div>
                <div id="fileList" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- Chat Box -->
            <div class="bg-white/10 backdrop-blur-sm border border-mystical-gold/30 rounded-lg mb-6 h-[32rem] overflow-hidden">
                <div class="h-full flex flex-col">
                    <div id="chatMessages" class="flex-1 overflow-y-auto p-6 space-y-6">
                        <!-- Welcome Message -->
                        <div class="text-center mt-16">
                            <div class="bg-white rounded-xl p-12 mx-auto max-w-lg shadow-2xl">
                                <div class="relative mx-auto mb-6 w-16 h-16 text-mystical-gold">
                                    <!-- Main star -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-sparkle">
                                        <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                                    </svg>
                                    <!-- Small stars around main star -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="absolute -top-3 -left-3 animate-sparkle delay-100">
                                        <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" class="absolute -bottom-2 -right-2 animate-sparkle delay-300">
                                        <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                                    </svg>
                                </div>
                                <h3 class="text-2xl font-quicksand font-semibold text-mystical-dark mb-4">
                                    Welcome to the mystical realm...
                                </h3>
                                <p class="text-mystical-dark/80 font-quicksand text-lg leading-relaxed">
                                    Ask Mistry AI anything, and receive wisdom beyond time. Upload files to give me context and memory.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex flex-wrap gap-3 mb-4 justify-center">
                <button id="scrollBtn" class="bg-white text-mystical-dark hover:bg-gray-100 font-railway border border-mystical-gold/30 px-4 py-2 rounded-lg">
                    Scroll: 1
                </button>
                <button id="speakBtn" class="bg-white text-mystical-dark hover:bg-gray-100 font-railway border border-mystical-gold/30 px-4 py-2 rounded-lg flex items-center">
                    <span class="text-2xl mr-2">🔈</span>
                    <span class="mx-1">၊၊</span>
                    <span class="mx-1">||</span>
                    <span class="mx-1">၊</span>
                    <span class="ml-2">Speak Wisdom</span>
                </button>
                <button id="voiceBtn" class="bg-white text-mystical-dark hover:bg-gray-100 font-railway border border-mystical-gold/30 px-4 py-2 rounded-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                        <line x1="12" x2="12" y1="19" y2="22"/>
                        <line x1="8" x2="16" y1="22" y2="22"/>
                    </svg>
                    Voice Spell
                </button>
                <button id="clearBtn" class="bg-white text-mystical-dark hover:bg-gray-100 font-railway border border-mystical-gold/30 px-4 py-2 rounded-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                        <path d="M3 6h18"/>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                    </svg>
                    Clear Scrolls
                </button>
            </div>

            <!-- Input Area -->
            <div class="flex gap-4 items-end">
                <input type="file" id="fileInput" class="hidden">
                <button id="uploadBtn" class="bg-mystical-gold/80 hover:bg-mystical-gold text-mystical-dark font-railway px-6 py-3 rounded-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7,10 12,15 17,10"/>
                        <line x1="12" x2="12" y1="15" y2="3"/>
                    </svg>
                    Upload
                </button>
                <div class="relative flex-1">
                    <textarea 
                        id="messageInput" 
                        placeholder="Speak your query to Mistry AI..."
                        class="w-full bg-white/25 border-2 border-mystical-gold/40 text-mystical-light placeholder-mystical-light/70 font-poppins text-base min-h-20 resize-none focus:border-mystical-gold/60 focus:ring-2 focus:ring-mystical-gold/30 rounded-lg p-3 pr-12"
                        rows="3"
                    ></textarea>
                    <button id="micBtn" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-mystical-gold/80 hover:bg-mystical-gold text-mystical-dark p-2 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            <line x1="12" x2="12" y1="19" y2="22"/>
                            <line x1="8" x2="16" y1="22" y2="22"/>
                        </svg>
                    </button>
                </div>
                <button id="sendBtn" class="bg-mystical-gold text-mystical-dark hover:bg-mystical-gold/80 font-railway px-6 py-3 h-20 rounded-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                        <path d="m22 2-7 20-4-9-9-4Z"/>
                        <path d="M22 2 11 13"/>
                    </svg>
                    Cast
                </button>
            </div>

            <footer class="text-center mt-8 text-mystical-light/60 font-quicksand">
                <p>&copy; 2025 Mistry AI - Where ancient wisdom meets modern intelligence</p>
            </footer>
        </div>
    </div>

    <script>
        // State management
        let fileMemory = [];
        let messages = [];
        let currentScroll = 1;
        let lastBotResponse = '';
        let isLoading = false;

        // DOM elements
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const clearBtn = document.getElementById('clearBtn');
        const speakBtn = document.getElementById('speakBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const micBtn = document.getElementById('micBtn');
        const scrollBtn = document.getElementById('scrollBtn');
        const fileMemoryPanel = document.getElementById('fileMemoryPanel');
        const fileList = document.getElementById('fileList');
        const fileCount = document.getElementById('fileCount');
        const clearAllFiles = document.getElementById('clearAllFiles');
        const infoBtn = document.getElementById('infoBtn');
        const infoModal = document.getElementById('infoModal');
        const closeModal = document.getElementById('closeModal');

        // Math operations
        function isMathProblem(input) {
            const mathPatterns = [
                /\d+\s*[+\-*/÷×]\s*\d+/,
                /what\s+is\s+\d+/i,
                /calculate/i,
                /solve/i,
                /\d+\s*\+\s*\d+/,
                /\d+\s*\-\s*\d+/,
                /\d+\s*\*\s*\d+/,
                /\d+\s*\/\s*\d+/,
                /\(\s*\d+/,
                /sqrt|square\s+root/i,
                /percentage|percent/i
            ];
            return mathPatterns.some(pattern => pattern.test(input));
        }

        function solveMathProblem(input) {
            try {
                const mathExpressions = input.match(/[\d+\-*/().\s]+/g);
                if (!mathExpressions) return null;

                let result = '';
                for (let expr of mathExpressions) {
                    expr = expr.trim();
                    if (expr.length > 0 && /\d/.test(expr)) {
                        try {
                            const cleanExpr = expr.replace(/[^0-9+\-*/().]/g, '');
                            if (cleanExpr) {
                                const evalResult = Function('"use strict"; return (' + cleanExpr + ')')();
                                result += `${cleanExpr} = ${evalResult}\n`;
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                }

                if (result) {
                    return `🧮 **Mathematical Solution:**\n\n${result}\n*Calculated locally by Mistry AI's ancient arithmetic scrolls*`;
                }
            } catch (error) {
                return null;
            }
            return null;
        }

        // UI functions
        function addMessage(text, sender, fileUrl = null, fileName = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const messageClass = sender === 'user' 
                ? 'bg-mystical-gold text-mystical-dark shadow-lg' 
                : sender === 'system'
                    ? 'bg-mystical-dark/80 text-mystical-gold border border-mystical-gold/60 italic shadow-lg'
                    : 'bg-white/25 text-mystical-light border border-mystical-gold/20 shadow-lg';

            messageDiv.innerHTML = `
                <div class="max-w-2xl px-6 py-4 rounded-xl font-quicksand text-base leading-relaxed ${messageClass}">
                    <div class="whitespace-pre-wrap break-words">
                        ${fileUrl ? `<a href="${fileUrl}" download="${fileName}" target="_blank" rel="noopener noreferrer" class="underline hover:text-mystical-gold animate-pulse">${text}</a>` : text}
                    </div>
                    <div class="text-xs opacity-70 mt-2">
                        ${new Date().toLocaleTimeString()}
                    </div>
                </div>
            `;

            if (chatMessages.children.length === 1) {
                chatMessages.innerHTML = '';
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            if (sender === 'bot') {
                lastBotResponse = text;
            }
        }

        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'flex justify-start';
            loadingDiv.id = 'loading';
            loadingDiv.innerHTML = `
                <div class="bg-white/25 text-mystical-light border border-mystical-gold/20 px-6 py-4 rounded-xl font-quicksand shadow-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-mystical-gold rounded-full animate-bounce"></div>
                        <div class="w-3 h-3 bg-mystical-gold rounded-full animate-bounce delay-100"></div>
                        <div class="w-3 h-3 bg-mystical-gold rounded-full animate-bounce delay-200"></div>
                        <span class="ml-3 text-base">Mistry AI is consulting the ancient texts...</span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideLoading() {
            const loading = document.getElementById('loading');
            if (loading) loading.remove();
        }

        function updateFileMemory() {
            if (fileMemory.length > 0) {
                fileMemoryPanel.classList.remove('hidden');
                fileCount.textContent = fileMemory.length;
                fileList.innerHTML = fileMemory.map(file => `
                    <div class="bg-mystical-gold/20 text-mystical-light px-3 py-1 rounded-full text-sm flex items-center border border-mystical-gold/30">
                        <span class="mr-2">${file.name}</span>
                        <button onclick="removeFile('${file.id}')" class="hover:bg-mystical-gold/30 rounded-full p-1 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 6 6 18"/>
                                <path d="m6 6 12 12"/>
                            </svg>
                        </button>
                    </div>
                `).join('');
                
                messageInput.placeholder = `Files in memory: ${fileMemory.map(f => f.name).join(', ')} - Ask your question...`;
            } else {
                fileMemoryPanel.classList.add('hidden');
                messageInput.placeholder = 'Speak your query to Mistry AI...';
            }
        }

        function removeFile(fileId) {
            fileMemory = fileMemory.filter(file => file.id !== fileId);
            updateFileMemory();
            showToast('File removed from memory');
        }

        function clearAllMemory() {
            fileMemory = [];
            updateFileMemory();
            showToast('All files cleared from memory');
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-mystical-gold text-mystical-dark px-4 py-2 rounded-lg shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Modal functions
        function showModal() {
            infoModal.classList.add('show');
        }

        function hideModal() {
            infoModal.classList.remove('show');
        }

        // Event handlers
        async function sendMessage() {
            const input = messageInput.value.trim();
            if (!input && fileMemory.length === 0) return;

            let fullPrompt = input;
            
            if (fileMemory.length > 0) {
                const fileContext = fileMemory.map(file => 
                    `File: ${file.name}\nContent:\n${file.content}`
                ).join('\n\n---\n\n');
                
                fullPrompt = `${fullPrompt}\n\nPreviously uploaded files:\n${fileContext}`;
            }

            messageInput.value = '';
            addMessage(input || 'Analyzing uploaded files...', 'user');
            isLoading = true;
            showLoading();

            try {
                if (isMathProblem(fullPrompt)) {
                    const localSolution = solveMathProblem(fullPrompt);
                    if (localSolution) {
                        setTimeout(() => {
                            hideLoading();
                            addMessage(localSolution, 'bot');
                            isLoading = false;
                            showToast('Calculated locally');
                        }, 300);
                        return;
                    }
                }

                // Try to connect to server first
                try {
                    const response = await fetch('http://localhost:5000/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: fullPrompt })
                    });

                    if (!response.ok) throw new Error('Network response was not ok');

                    const data = await response.json();
                    hideLoading();
                    addMessage(data.reply, 'bot');
                    isLoading = false;
                    showToast('Response received from server');
                } catch (serverError) {
                    // Fallback to local response
                    setTimeout(() => {
                        hideLoading();
                        addMessage(`🔮 **Mystical Response (Offline Mode):**\n\nI sense your query through the ethereal realm: "${input}"\n\nWhile I cannot connect to the mystical servers at this moment, I can still assist with:\n\n• Mathematical calculations (which I solve locally)\n• File analysis from your uploaded documents\n• General wisdom and guidance\n\nYour uploaded files are safely stored in my memory for context. The server appears to be unreachable, but I'm still here to help with local processing!`, 'bot');
                        isLoading = false;
                        showToast('Server unavailable - running in offline mode');
                    }, 1000);
                }
            } catch (error) {
                hideLoading();
                addMessage('⚠️ Error: Could not process your request. Please try again.', 'bot');
                showToast('Failed to process request');
                isLoading = false;
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const localUrl = URL.createObjectURL(file);
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const content = e.target.result;
                    let fileContent = '';
                    
                    if (file.type.startsWith('text/') || file.name.endsWith('.txt') || file.name.endsWith('.md')) {
                        fileContent = content;
                    } else if (file.type === 'application/json') {
                        try {
                            fileContent = JSON.stringify(JSON.parse(content), null, 2);
                        } catch {
                            fileContent = content;
                        }
                    } else {
                        fileContent = content.substring(0, 500) + (content.length > 500 ? '...' : '');
                    }
                    
                    const newFile = {
                        id: Date.now().toString(),
                        name: file.name,
                        content: fileContent,
                        uploadedAt: new Date()
                    };
                    
                    fileMemory.push(newFile);
                    updateFileMemory();
                    
                    addMessage(
                        `📄 File added to memory: ${file.name}${fileContent ? '\n\nPreview:\n' + fileContent.substring(0, 200) + (fileContent.length > 200 ? '...' : '') : '\n(Binary file - content stored in memory)'}`,
                        'system'
                    );
                };
                
                reader.readAsText(file);
                showToast(`File "${file.name}" added to AI memory!`);
            }
            event.target.value = ''; // Reset file input
        }

        function toggleScroll() {
            currentScroll = currentScroll === 1 ? 2 : 1;
            scrollBtn.textContent = `Scroll: ${currentScroll}`;
            showToast(`Scroll mode: ${currentScroll}`);
        }

        function speakResponse() {
            if (!lastBotResponse) {
                showToast('No response to speak');
                return;
            }
            const utterance = new SpeechSynthesisUtterance(lastBotResponse);
            utterance.lang = 'en-US';
            speechSynthesis.cancel();
            speechSynthesis.speak(utterance);
            showToast('Speaking response');
        }

        function startVoiceRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                showToast('Speech recognition not supported in this browser');
                return;
            }
            const recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.onresult = (event) => {
                messageInput.value = event.results[0][0].transcript;
                showToast('Voice recognized');
            };
            recognition.onerror = (event) => {
                showToast(`Voice recognition error: ${event.error}`);
            };
            recognition.start();
            showToast('Listening...');
        }

        function clearChat() {
            chatMessages.innerHTML = `
                <div class="text-center mt-16">
                    <div class="bg-white rounded-xl p-12 mx-auto max-w-lg shadow-2xl">
                        <div class="relative mx-auto mb-6 w-16 h-16 text-mystical-gold">
                            <!-- Main star -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-sparkle">
                                <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                            </svg>
                            <!-- Small stars around main star -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="absolute -top-3 -left-3 animate-sparkle delay-100">
                                <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" class="absolute -bottom-2 -right-2 animate-sparkle delay-300">
                                <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .962L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-quicksand font-semibold text-mystical-dark mb-4">
                            Welcome to the mystical realm...
                        </h3>
                        <p class="text-mystical-dark/80 font-quicksand text-lg leading-relaxed">
                            Ask Mistry AI anything, and receive wisdom beyond time. Upload files to give me context and memory.
                        </p>
                    </div>
                </div>
            `;
            messages = [];
            showToast('Chat cleared');
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        uploadBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileUpload);
        clearBtn.addEventListener('click', clearChat);
        speakBtn.addEventListener('click', speakResponse);
        voiceBtn.addEventListener('click', startVoiceRecognition);
        micBtn.addEventListener('click', startVoiceRecognition);
        scrollBtn.addEventListener('click', toggleScroll);
        clearAllFiles.addEventListener('click', clearAllMemory);
        
        // Modal event listeners
        infoBtn.addEventListener('click', showModal);
        closeModal.addEventListener('click', hideModal);
        infoModal.addEventListener('click', (e) => {
            if (e.target === infoModal) hideModal();
        });

        // Make removeFile globally accessible
        window.removeFile = removeFile;

        // Initialize
        updateFileMemory();
        
        // Scroll to top on load
        window.scrollTo(0, 0);
    </script>
</body>
</html>
